# performance_management
基于django制造行业企业内部绩效管理系统
> 集成了数据管理、可视化、用户管理、权限组、日志、数据库备份、开放接口等实用功能

# 功能菜单一览
- 首页
  - 展示了系统概要信息
  - 当月新增订单数
  - 您的工号、部门、角色
  - 系统公告
  - 本月待完成订单概览
- 数据统计查看
  - 月度营业数据
  - 季度营业数据
  - 内控指标汇总
  - 月度绩效考核结果
  - 季度绩效考核结果
  - 季度绩效奖金
- 业务数据管理
  - 月度营业数据
  - 内控指标汇总
  - 常量数据
- 报表公式修改
  - 月度绩效考核结果
  - 季度绩效考核结果
  - 季度绩效奖金
- 账号权限管理
  - 账号信息管理
  - 角色权限管理
- 系统安全备份
  - 用户操作日志
  - 数据备份还原
  - 系统开放接口

### 系统特色功能
- 生成公式高度自定义，灵活满足不同企业需求
- 移动端视觉效果优越，优化用户体验
- 权限管理严格，看不到没有权限的任何部分
- 日志系统，便于事故追责及系统使用率统计
- 数据库备份系统，可手动/自动备份整个数据库，提高系统容灾性
- 高度可自定义的接口系统，可自定义开放接口，便于与其他系统进行数据对接

# 功能详细介绍
### 首页
首页展示了系统以及用户的概要信息

用户的信息包括**工号**、**部门**、**角色**

系统概要信息包括
- **当月新增订单数**
> 订单日期在当前月的订单数量
- **系统公告**
> 只展示最新三条，可点击*查看更多公告*来查看历史公告
- **本月待完成订单**
> 只有拥有*内控指标汇总查看权限*的用户才可以看到。计划交期在本月的订单信息将在此展示，展示*订单号*、*订单时间*、*计划交期*、*订单状态*、*时间进度*

### 数据统计查看
> 本模块仅用于数据展示以及可视化
#### 月度营业数据
本页面展示了月度营业数据
- 数据项有：
  - 月份
  - 营业额(万元)
  - 营业费用(万元)
  - 回款额(万元)
  - 库存量
  - 利润额(万元)
- 功能项有：
  - 导出Excel表格
  - 查看可视化图表(E charts)
  - 按照年份筛选数据

#### 季度营业数据
本页面展示了季度营业数据
- 数据项有：
  - 季度
  - 营业额(万元)
  - 营业费用(万元)
  - 回款额(万元)
  - 库存量
  - 利润额(万元)
> 数据项是根据月度营业数据自动生成
- 功能项与**月度营业数据**一样

#### 内控指标汇总
本页面展示了订单信息
- 数据项有：
  - 状态(分为六种)
    - 按时完成(*实际交期*在*计划交期*之前或当天)
    - 尚未完成(没有*实际交期*并且当前日期没有超过*计划交期*而且*时间进度*小与设定阈值)
    - 逾期完成(*实际交期*在*计划交期*之后)
    - 快到交期(没有*实际交期*并且当前交期没有超过*计划交期*而且*时间进度*大于设定阈值)
    - 已经逾期(没有*实际交期*并且当前日期已经超过*计划交期*)
    - 还未开始(没有*实际交期*并且当前时间在*订单时间*之前)
  - 时间进度(根据*订单时间*和*计划交期*计算得到一个时间段，计算*当前日期*在这个时间段的百分比位置来获得的一个进度条)
  - 订单时间
  - 订单号
  - 订单额
  - 计划交期
  - 目标成品率
  - 目标医药费(万元)
  - 目标综合成本(万元)
  - 目标管理符合数
  - 实际交期
  - 完成数
  - 未完成数
  - 实际成品率
  - 实际医药费
  - 实际成本
  - 实际管理符合数
> 实际交期以及之后的数据是订单完成后加入的，如果没有说明此订单未完成
- 功能项有：
  - 导出Excel表格
  - 根据状态筛选
  - 根据订单号模糊查找
  - 根据订单日期进行日期段查找

#### 月度绩效考核结果
本页面展示了月度绩效考核结果信息
- 数据项有：
  - 月份
  - 交付率
  - 成品率
  - 医药费(万元)
  - 当月挖掘成本(万元)
  - 现场管理符合率
> 所有数据根据给定的公式自动生成，公式可在**报表公式修改**模块进行自定义修改
- 功能项有：导出Excel表格
- 查看可视化图表(E charts)
- 根据年份筛选数据

#### 季度绩效考核结果
本页面展示了季度绩效考核结果信息
- 数据项有：
  - 季度
  - 营业额(万元)
  - 营业费率
  - 回款率
  - 库存率
  - 利润率
> 所有数据根据给定的公式自动生成，公式可在**报表公式修改**模块进行自定义修改
- 功能项跟**月度绩效考核结果**一样

#### 季度绩效奖金
本页面展示了季度绩效奖金信息
- 数据项有：
  - 季度
  - 营业奖金
  - 营业费率奖金
  - 回款额奖金
  - 库存率奖金
  - 利润率奖金
  - 合计
> 所有数据根据给定的公式自动生成，公式可在**报表公式修改**模块进行自定义修改
- 功能项跟**月度绩效考核结果**一样

### 业务数据管理
> 本模块用于管理数据和常量
#### 月度营业数据
本页面用于管理月度营业数据
- 新增数据
  - 手动新增
  - Excel批量导入
- 删除数据
  - 点击数据项后边的删除按钮单条删除
  - 多选批量删除
- 修改数据
- 根据年份筛选

#### 内控指标汇总
本页面用于管理订单信息
> 操作跟月度营业数据差不多，只是新增的时候只有订单创建信息，完成订单需要再次修改，导入表格可以导入完整的信息

其中有一些特殊数据
- 目标成品率--固定为100%
- 目标医药费--根据*订单额*与**常量数据**中*目标医药费百分比*相乘得出
- 目标综合成本--根据*订单额*与**常量数据**中*目标综合成本百分比*相乘得出
- 目标管理符合数--根据*订单额*与**常量数据**中*目标管理符合数值*相乘得出
- 完成数--*实际交期*在*计划交期*之前或当日则为1，否则为0
- 未完成数--*实际交期*在*计划交期*之前或当日则为0，否则为1

#### 常量数据
本页面用于管理常量数据
- 数据项有：
  - 启用日(影响这个日期之后的相应数据)
  - 年度目标营业额
  - 年度目标奖金额
  - 目标医药费百分比
  - 目标综合成本百分比
  - 目标管理符合数值
- 功能项有：
  - 新增
  - 单选/多选删除
  - 修改

### 报表公式修改
本模块用于修改三个表的数据生成公式
- 月度绩效考核结果
- 季度绩效考核结果
- 季度绩效奖金
> 每个页面的参数提示说明文字点击可以进行修改，以实现说明的自定义

### 账号权限管理
本模块用于管理账号以及权限
> 权限分配基于角色，通过给角色设置权限和给用户赋予角色来实现权限的批量分配
#### 账号信息管理
本页面管理系统中的账号信息以及系统登录方式
- 系统登录方式(可根据需求开启/禁用某些登录方式)
  - 工号登录
  - 短信验证
  - 邮箱验证
  - 微信扫码
> 后三者需要自己配置短信API/邮箱信息/微信API，我们不提供～
- 新增用户信息
  - 导入Excel
  - 手动录入

#### 角色权限管理
本页面对系统角色进行管理
> 新增角色时给角色命名并将相应权限打开，也可以后期修改权限。在管理用户页面进行角色赋予操作，提供模糊查找以及多选等人性化操作

### 系统安全备份
本模块进行系统安全方面的操作，包括日志、数据库备份和开放接口
#### 用户操作日志
本页面记录了所有用户对于系统修改做出的操作信息
- 时间
- 操作账号
- 账号工号
- 操作内容
- 操作结果
> 提供导出Excel、可视化展示以及姓名/工号模糊查找

#### 数据备份还原
本页面进行系统数据库备份操作
- 手动备份
- 上传本地备份
- 设置备份周期自动备份并发送邮箱
- 恢复指定数据备份文件
- 下载数据备份文件到本地
- 删除备份文件
- 搜索备份文件

#### 系统开放接口
本页面提供高度自定义的开放接口配置
- 可自定义选择开放所有数据表的任意字段
- 可以给接口设置密码，提高安全性
- 可以限制接口请求方式(POST/GET)，提高安全性
- 给接口写简介，记录用途
- 临时禁用接口，以处理突发情况
- 自动记录接口调用次数及最近调用时间，方便找出活跃接口和无用接口

# 部署流程

### 用到的Python库
- django(web框架)
- django-cors-headers(配置跨域访问)
- gunicorn(仅部署用)
- psycopg2(pg数据库连接)
- python-dateutil(处理日期相关)
- xlrd(读取excel)
- xlwt(生成excel)
- apscheduler(执行定时任务)
- requests(发送API请求)

### 服务器部署
#### 简单部署(性能低，不推荐)
- 将本项目文件克隆到服务器中，在项目根目录环境下执行`python manage.py runserver 0.0.0.0:80`来将系统开启在80端口。
#### nginx+gunicorn+django部署(性能高，推荐)
- 安装nginx
  - sudo apt install nginx(Debian系)
  - yum install ngxin(centos一类)
- 修改项目根目录的**nginx.conf**文件，主要是根据具体需求修改监听端口，并且按照文件开头提示进行链接操作
- 启动gunicorn服务，在项目根目录执行`gunicorn performance_management.wsgi -c gunicorn_conf.py`来开启gunicorn
- 重启nginx，执行`nginx -s reload`来重启nginx，使其重载配置文件
- 测试是否成功
#### docker+nginx+gunicorn+django部署(容器化管理，我本人正在使用的方法，同样推荐)
- 下载我制作的docker镜像`docker pull lvpeng990324/django-nginx:latest`，它里边自带了nginx和Django环境，但是可能库还不全，需要attach进去手动安装。
- 将项目文件拷贝到容器根目录或者挂载在容器根目录
- 将容器开启命令路径设为项目根目录，并设置执行`/bin/bash ./start_gunicorn.sh`，将每次启动容器的时候自动启动gunicorn服务并且重启nginx。

### 系统初始化
> 系统自带一个初始化用的数据库备份文件，在系统根目录的backups目录下，文件名为**initialization.json**，部署好后，在系统根目录下执行`python manage.py loaddata ./backups/initialization.json`来加载初始化的数据，加载完成后将拥有一个工号为`admin` , 密码为`admin`的超级管理员账户。初始化完成后请即刻更改这个超级管理员的工号和密码，并在**数据备份还原**中删除**initialization.json**备份文件。
